<div class="m-circulation">
  <div class="m-circulation-content">
    <div class="container-fluid">
      <form>
        <div class="row justify-content-between m-header-component m-header-component__container">
          <div class="col flex-first">
            <h4>Emprunt <i *ngIf="isItemLoading || isExecutingLoan" class="fa fa-spinner fa-pulse" aria-hidden="true"></i></h4>
          </div>
          <div class="col flex-last">
            <button (click)="onSubmit()" type="submit" class="btn btn-warning float-right" #checkoutBtn>
              <i class="fa fa-arrow-up" aria-hidden="true"></i>
            </button>
          </div>
        </div>
        <div bsModal #overQuotaModal="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-lg">
            <div class="modal-content">
              <div class="modal-header">
                <h4 class="modal-title pull-left">Quota atteint</h4>
                <button type="button" class="close pull-right" aria-label="Close" (click)="hideOverQuotaModal()">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                Le quota maximal est déjà atteint pour cet utilisateur, voulez vous tout de même emprunter le document ?
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-primary" (click)="borrowOverQuota()">Emprunter</button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal" (click)="hideOverQuotaModal()">Annuler</button>
              </div>
            </div>
          </div>
        </div>
        <div class="my-2">
          <template #typeaheadItemTemplate let-item="item" let-index="index">
            <small>{{item.internalId}}: {{item.record?.title.mainTitle}}</small>
          </template>
          <div class="row">
            <div class="col">
              <div class="form-group">
                <label>Identifiant</label>
                <input [(ngModel)]="internalId"
                       [typeahead]="dataSource"
                       [typeaheadItemTemplate]="typeaheadItemTemplate"
                       (typeaheadLoading)="updateIsItemLoading($event)"
                       (typeaheadOnSelect)="setSelectedItem($event)"
                       typeaheadWaitMs="300"
                       typeaheadOptionField="internalId"
                       autocomplete="off"
                       class="form-control form-control-sm"
                       placeholder="Identifiant du document"
                       name="internal-id"
                       (focus)="resetInputs($event)">
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col">
              <div class="form-group">
                <label>ISBN</label>
                <input #serialNumberInput [(ngModel)]="serialNumber"
                       [typeahead]="dataSource"
                       [typeaheadItemTemplate]="typeaheadItemTemplate"
                       (typeaheadLoading)="updateIsItemLoading($event)"
                       (typeaheadOnSelect)="setSelectedItem($event)"
                       typeaheadWaitMs="300"
                       typeaheadMinLength="10"
                       typeaheadOptionField="record.identifier.serialNumber"
                       autocomplete="off"
                       maxlength="17"
                       name="serial-number"
                       placeholder="Code-barres ou ISBN"
                       class="form-control form-control-sm"
                       (focus)="resetInputs($event)">
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col">
              <div class="form-group">
                <label>Titre</label>
                <input [(ngModel)]="title"
                       [typeahead]="dataSource"
                       [typeaheadItemTemplate]="typeaheadItemTemplate"
                       (typeaheadLoading)="updateIsItemLoading($event)"
                       (typeaheadOnSelect)="setSelectedItem($event)"
                       typeaheadWaitMs="300"
                       typeaheadMinLength="3"
                       typeaheadOptionField="record.title.mainTitle"
                       autocomplete="off"
                       name="title"
                       placeholder="Titre"
                       class="form-control form-control-sm"
                       (focus)="resetInputs($event)">
              </div>
            </div>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>
